name: carulla
prefect-version: 3.0.0

flows:
  - name: flujo_diario
    entrypoint: descarga_diaria.py:flujo_diario

deployments:
  - name: descarga_diaria_6am
    flow_name: flujo_diario
    schedule:
      cron: "0 6 * * *"
    work_pool:
      name: descarga-managed
      work_queue_name: default
      job_variables:
        # Usas una imagen de Prefect 3.12, que es la correcta
        image: prefecthq/prefect:3-python3.12
        env:
          PREFECT_LOGGING_LEVEL: INFO
          # Importante para los errores de codificaciÃ³n previos
          PYTHONIOENCODING: utf-8
    
    # ðŸš¨ PULL_STEPS: ESTE BLOQUE ES LA CLAVE DE LA INSTALACIÃ“N ðŸš¨
    pull_steps:
      - prefect.deployments.steps.run_shell_script:
          script: |
            echo "ðŸ”§ Iniciando instalaciÃ³n de dependencias..."
            # Forzamos a usar el binario de Python dentro del entorno. 
            # Esto es mÃ¡s robusto que solo 'pip'.
            /usr/local/bin/python -m pip install --no-cache-dir requests pandas openpyxl
            echo "âœ… Dependencias instaladas. ContinuarÃ¡ la ejecuciÃ³n del flujo."

