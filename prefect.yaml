name: carulla
prefect-version: 3.0.0

flows:
  - name: flujo_diario
    entrypoint: descarga_diaria.py:flujo_diario

deployments:
  - name: descarga_diaria_6am
    flow_name: flujo_diario
    schedule:
      cron: "0 6 * * *"
    work_pool:
      name: descarga-managed
      work_queue_name: default
      job_variables:
        # La imagen base puede ser cualquiera de Prefect que uses.
        image: prefecthq/prefect:3-python3.12 
        env:
          PREFECT_LOGGING_LEVEL: INFO
    # 🚨 LA SOLUCIÓN ESTÁ AQUÍ 🚨
    # Estos pasos se ejecutan DESPUÉS de descargar el código de Git y ANTES del flujo.
    pull_steps:
      - prefect.deployments.steps.run_shell_script:
          script: |
            echo "🔧 Instalando dependencias..."
            # Asumiendo que tienes un requirements.txt en tu repo:
            # pip install --no-cache-dir -r requirements.txt 
            # O instalando directamente las librerías:
            pip install --no-cache-dir requests pandas openpyxl
            echo "✅ Dependencias instaladas"




